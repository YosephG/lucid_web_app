(function(){(this||window).webpackJsonp.registerAbsMids({"esri/layers/mixins/ArcGISCachedService":1341,"esri/layers/support/TilemapCache":1416,"esri/layers/support/Tilemap":1430})})(),(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{1341:function(e,t,i){var a,l;a=[i.dj.c(e.i),t,i(12),i(2),i(1),i(29),i(0),i(174),i(455),i(1416)],void 0===(l=function(e,t,i,a,l,r,n,o,s,p){return function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.copyright=null,t.minScale=0,t.maxScale=0,t.spatialReference=null,t.tileInfo=null,t.tilemapCache=null,t}return a(t,e),Object.defineProperty(t.prototype,"supportsBlankTile",{get:function(){return this.version>=10.2},enumerable:!0,configurable:!0}),t.prototype.readTileInfo=function(e,t){var i=function(e){return Math.round(1e4*e)/1e4},a=t.minScale?i(t.minScale):1/0,l=t.maxScale?i(t.maxScale):-1/0;return e?(e.lods=e.lods.filter(function(e){var t=i(e.scale);return t<=a&&t>=l}),s.fromJSON(e)):null},t.prototype.readTilemapCache=function(e,t){return t.capabilities&&t.capabilities.indexOf("Tilemap")>-1?new p({layer:this}):null},l([n.property({json:{read:{source:"copyrightText"}}})],t.prototype,"copyright",void 0),l([n.property({json:{origins:{service:{read:!1}}}})],t.prototype,"minScale",void 0),l([n.property({json:{origins:{service:{read:!1}}}})],t.prototype,"maxScale",void 0),l([n.property({type:r.SpatialReference})],t.prototype,"spatialReference",void 0),l([n.property({readOnly:!0,dependsOn:["version"]})],t.prototype,"supportsBlankTile",null),l([n.property({type:s})],t.prototype,"tileInfo",void 0),l([n.reader("service","tileInfo",["tileInfo","minScale","maxScale"])],t.prototype,"readTileInfo",null),l([n.property()],t.prototype,"tilemapCache",void 0),l([n.reader("service","tilemapCache",["capabilities"])],t.prototype,"readTilemapCache",null),l([n.property()],t.prototype,"version",void 0),l([n.subclass("esri.layers.mixins.ArcGISCachedService")],t)}(n.declared(o))}.apply(null,a))||(e.exports=l)},1416:function(e,t,i){var a,l;a=[i.dj.c(e.i),t,i(12),i(2),i(1),i(78),i(27),i(4),i(9),i(15),i(7),i(468),i(8),i(17),i(0),i(1430)],void 0===(l=function(e,t,i,a,l,r,n,o,s,p,c,u,h,v,f,y){var d=c.getLogger("esri.layers.support.TilemapCache");return function(e){function t(t){var i=e.call(this)||this;return i._handles=new p,i._pendingTilemapRequests={},i._availableLevels={},i.levels=5,i.cacheByteSize=2097152,i.request=n,i}return a(t,e),t.prototype.initialize=function(){var e=this;this._tilemapCache=new u(this.cacheByteSize,{sizeOfFunction:function(e){return e.byteSize}}),this._handles.add([this.watch(["layer.parsedUrl","layer.tileServers"],function(){return e._initializeTilemapDefinition()}),v.init(this,"layer.tileInfo.lods",function(t){return e._initializeAvailableLevels(t)},!0)]),this._initializeTilemapDefinition()},t.prototype.destroy=function(){this._handles&&(this._handles.destroy(),this._handles=null)},t.prototype.castLevels=function(e){return e<=2?(d.error("Minimum levels for Tilemap is 3, but got ",e),3):e},Object.defineProperty(t.prototype,"size",{get:function(){return 1<<this.levels},enumerable:!0,configurable:!0}),t.prototype.getTilemap=function(e,t,i){return this._tilemapFromCache(e,t,i,this._tmpTilemapDefinition)},t.prototype.fetchTilemap=function(e,t,i,a){var l=this;if(!this._availableLevels[e])return h.reject(new s("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"));var r=this._tmpTilemapDefinition,n=this._tilemapFromCache(e,t,i,r);if(n)return h.resolve(n);var o=y.tilemapDefinitionId(r),p=this._pendingTilemapRequests[o];return p||(p=y.Tilemap.fromDefinition(r,a).then(function(e){return l._tilemapCache.set(o,e),delete l._pendingTilemapRequests[o],e}).catch(function(e){return delete l._pendingTilemapRequests[o],h.reject(e)}),this._pendingTilemapRequests[o]=p),h.create(function(e,t){p.then(e,t)})},t.prototype.getAvailability=function(e,t,i){if(!this._availableLevels[e])return"unavailable";var a=this.getTilemap(e,t,i);return a?a.getAvailability(t,i):"unknown"},t.prototype.getAvailabilityUpsample=function(e,t,i,a){a.level=e,a.row=t,a.col=i;var l=this.layer.tileInfo;for(l.updateTileInfo(a);;){var r=this.getAvailability(a.level,a.row,a.col);if("unavailable"!==r)return r;if(!l.upsampleTile(a))return"unavailable"}},t.prototype.fetchAvailability=function(e,t,i,a){return this._availableLevels[e]?this.fetchTilemap(e,t,i,a).always(function(a){if(a instanceof y.Tilemap){var l=a.getAvailability(t,i);return"unavailable"===l?h.reject(new s("tile-map:tile-unavailable","Tile is not available",{level:e,row:t,col:i})):l}return a&&"cancel"===a.dojoType?h.reject(a):"unknown"}):h.reject(new s("tilemap-cache:level-unavailable","Level "+e+" is unavailable in the service"))},t.prototype.fetchAvailabilityUpsample=function(e,t,i,a,l){var r=this;a.level=e,a.row=t,a.col=i;var n=this.layer.tileInfo;return n.updateTileInfo(a),this.fetchAvailability(e,t,i,l).catch(function(e){return e&&"cancel"===e.dojoType?h.reject(e):n.upsampleTile(a)?r.fetchAvailabilityUpsample(a.level,a.row,a.col,a):h.reject(e)})},t.prototype._initializeTilemapDefinition=function(){if(this.layer.parsedUrl){var e=this.layer.parsedUrl,t=e.query;t&&t.token||!this.layer.token||(t=i({},t,{token:this.layer.token})),this._tilemapCache.clear(),this._tmpTilemapDefinition={service:{url:e.path,query:t?r.objectToQuery(t):null,tileServers:this.layer.tileServers,request:this.request,type:this.layer.type},width:this.size,height:this.size,level:0,row:0,col:0}}},t.prototype._tilemapFromCache=function(e,t,i,a){var l=this._getTilemapDefinition(e,t,i,a),r=y.tilemapDefinitionId(l);return this._tilemapCache.get(r)},t.prototype._getTilemapDefinition=function(e,t,i,a){return a.level=e,a.row=t-t%this.size,a.col=i-i%this.size,a},t.prototype._initializeAvailableLevels=function(e){var t=this;this._availableLevels={},e&&e.forEach(function(e){return t._availableLevels[e.level]=!0})},l([f.property({constructOnly:!0,type:Number})],t.prototype,"levels",void 0),l([f.cast("levels")],t.prototype,"castLevels",null),l([f.property({readOnly:!0,dependsOn:["levels"],type:Number})],t.prototype,"size",null),l([f.property({constructOnly:!0,type:Number})],t.prototype,"cacheByteSize",void 0),l([f.property({constructOnly:!0})],t.prototype,"layer",void 0),l([f.property({constructOnly:!0})],t.prototype,"request",void 0),l([f.subclass("esri.layers.support.TilemapCache")],t)}(f.declared(o))}.apply(null,a))||(e.exports=l)},1430:function(e,t,i){var a,l;a=[i.dj.c(e.i),t,i(12),i(27),i(9),i(5),i(8)],void 0===(l=function(e,t,i,a,l,r,n){function o(e){var t;if("vector-tile"===e.service.type)t=e.service.url+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height;else{var i=e.service.tileServers;t=(i&&i.length?i[e.row%i.length]:e.service.url)+"/tilemap/"+e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height}var a=e.service.query;return a&&(t=t+"?"+a),t}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(){this.location={left:0,top:0,width:0,height:0},this.byteSize=40}return e.prototype.getAvailability=function(e,t){if(this._isAllAvailable)return"available";if(this._isAllUnvailable)return"unavailable";var i=(e-this.location.top)*this.location.width+(t-this.location.left),a=i%8,l=i>>3,r=this._tileAvailabilityBitSet;return l<0||l>r.length?"unknown":r[l]&1<<a?"available":"unavailable"},e.prototype._updateFromData=function(e){for(var t=this.location.width,i=this.location.height,a=!0,l=!0,r=Math.ceil(t*i/8),n=new Uint8Array(r),o=0,s=0;s<e.length;s++){var p=s%8;e[s]?(l=!1,n[o]|=1<<p):a=!1,7===p&&++o}this._isAllUnvailable=l,this._isAllAvailable=a,this._isAllAvailable||this._isAllUnvailable||(this._tileAvailabilityBitSet=n,this.byteSize+=n.length)},e.fromDefinition=function(t,r){var s=t.service.request||a,p=t.row,c=t.col,u=t.width,h=t.height,v={query:{f:"json"},callbackParamName:"callback"};return r=r?i({},v,r):v,s(o(t),r).then(function(e){return e.data}).catch(function(e){return e&&e.details&&422===e.details.httpStatus?{location:{top:p,left:c,width:u,height:h},valid:!0,data:function(){for(var e=[],t=0,i=u*h;t<i;t++)e[t]=0;return e}()}:n.reject(e)}).then(function(t){if(t.location&&(t.location.top!==p||t.location.left!==c||t.location.width!==u||t.location.height!==h))throw new l("tilemap:location-mismatch","Tilemap response for different location than requested",{response:t,definition:{top:p,left:c,width:u,height:h}});return e.fromJSON(t)})},e.fromJSON=function(t){e.validateJSON(t);var i=new e;return i.location=Object.freeze(r.clone(t.location)),i._updateFromData(t.data),Object.freeze(i)},e.validateJSON=function(e){if(!e||!e.location)throw new l("tilemap:missing-location","Location missing from tilemap response");if(!1===e.valid)throw new l("tilemap:invalid","Tilemap response was marked as invalid");if(!e.data)throw new l("tilemap:missing-data","Data missing from tilemap response");if(!Array.isArray(e.data))throw new l("tilemap:data-mismatch","Data must be an array of numbers");if(e.data.length!==e.location.width*e.location.height)throw new l("tilemap:data-mismatch","Number of data items does not match width/height of tilemap")},e}();t.Tilemap=s,t.tilemapDefinitionId=function(e){return e.level+"/"+e.row+"/"+e.col+"/"+e.width+"/"+e.height},t.tilemapDefinitionUrl=o,t.default=s}.apply(null,a))||(e.exports=l)}}]);